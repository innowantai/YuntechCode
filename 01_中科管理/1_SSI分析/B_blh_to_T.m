function T2 = B_blh_to_T(YY,i,j,n)
 
T2 = zeros(n*i,n*i);  
 
 
k = 1 ;T2(1:n,[1+n*(k-1)]:n*k) = YY(:,(1+i):(j+i))*YY(:,(1+k-1):(j+k-1))'; 
k = 2 ;T2(1:n,[1+n*(k-1)]:n*k) = YY(:,(1+i):(j+i))*YY(:,(1+k-1):(j+k-1))'; 
       T2([1+n*(k-1)]:n*k,1:n) = YY(:,(1+i+k-1):(j+i+k-1))*YY(:,1:j)';      
     
for k2 = 1 :i - k 
    k = 2 ;
    T2((1+n*k2):(n+n*k2),(1+n*(k-1)+n*k2):(n*k+n*k2)) = T2(1:n,[1+n*(k-1)]:n*k) - YY(:,(1+i):(1+i+k2-1))*YY(:,(1+k-1):(1+k-1+k2-1))' + YY(:,(j+i+1):(j+i+k2-1+1))*YY(:,(j+k-1+1):(j+k-1+k2-1+1))';
    T2((1+n*(k-1)+n*k2):(n*k+n*k2),(1+n*k2):(n+n*k2)) = T2([1+n*(k-1)]:n*k,1:n) - YY(:,(1+i+k-1):(1+i+k-1+k2-1))*YY(:,(1):(1+k2-1))'  +YY(:,(j+i+k-1+1):(j+i+k-1+k2-1+1))*YY(:,(j+1):(j+k2-1+1))';
    k = 1 ;T2((1+n*k2):(n+n*k2),(1+n*(k-1)+n*k2):(n*k+n*k2)) = T2(1:n,[1+n*(k-1)]:n*k) - YY(:,(1+i):(1+i+k2-1))*YY(:,(1+k-1):(1+k-1+k2-1))' + YY(:,(j+i+1):(j+i+k2-1+1))*YY(:,(j+k-1+1):(j+k-1+k2-1+1))';
end   
 
 
k2 = i-1 ; T2((1+n*k2):(n+n*k2),(1+n*(k-1)+n*k2):(n*k+n*k2)) = T2(1:n,[1+n*(k-1)]:n*k) - YY(:,(1+i):(1+i+k2-1))*YY(:,(1+k-1):(1+k-1+k2-1))' + YY(:,(j+i+1):(j+i+k2-1+1))*YY(:,(j+k-1+1):(j+k-1+k2-1+1))';    
 
 
for k = 3 : i
   
    T2(1:n,[1+n*(k-1)]:n*k) = YY(:,(1+i):(j+i))*YY(:,(1+k-1):(j+k-1))'; 
    T2([1+n*(k-1)]:n*k,1:n) = YY(:,(1+i+k-1):(j+i+k-1))*YY(:,1:j)'; 
   
     
    
    for k2 = 1 :i - k       
        T2((1+n*k2):(n+n*k2),(1+n*(k-1)+n*k2):(n*k+n*k2)) = T2(1:n,[1+n*(k-1)]:n*k) - YY(:,(1+i):(1+i+k2-1))*YY(:,(1+k-1):(1+k-1+k2-1))' + YY(:,(j+i+1):(j+i+k2-1+1))*YY(:,(j+k-1+1):(j+k-1+k2-1+1))';
        T2((1+n*(k-1)+n*k2):(n*k+n*k2),(1+n*k2):(n+n*k2)) = T2([1+n*(k-1)]:n*k,1:n) - YY(:,(1+i+k-1):(1+i+k-1+k2-1))*YY(:,(1):(1+k2-1))'  +YY(:,(j+i+k-1+1):(j+i+k-1+k2-1+1))*YY(:,(j+1):(j+k2-1+1))';
    end
    
    
end

T2 = T2 / (j-1);
  